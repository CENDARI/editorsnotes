{% extends "form.html" %}
{% load typogrify display %}
{% load staticfiles compress %}


{% block form_init %}
<meta name="project_id" id="project_id" content="{{ project.id }}" />


{% endblock form_init %}

{% block form_content %}

	{%if user_has_perm %}

		{{ form.as_p }}
		<!-- <input class="btn" type="submit" value="Save"> -->


		<h1 id="header"> Choose editors </h1>
		  <ul id="list">
			{% for user in users %}
				<li>
					{{user.username}} <input id='{{user.username}}_checkbox'type="checkbox" name="iEditor" value="{{user.username}}">	
				</li>						
			{% endfor%}
		</ul>

	 {% else %}
	 	
	 	<h1>Your are in project <u>{{project.name}}</u></h1>

	 {%endif%}

{% endblock form_content %}


{% block form_functions %}
<script>

(function ($) {
  // custom css expression for a case-insensitive contains()
  jQuery.expr[':'].Contains = function(a,i,m){
      return (a.textContent || a.innerText || "").toUpperCase().indexOf(m[3].toUpperCase())>=0;
  };


  function listFilter(header, list) { // header is any element, list is an unordered list
    // create and add the filter form to the header
    var form = $("<form>").attr({"class":"filterform","action":"#"}),
        input = $("<input>").attr({"class":"filterinput","type":"text"});
    $(form).append(input).appendTo(header);

    $(input)
      .change( function () {
        var filter = $(this).val();
        if(filter) {
          // this finds all links in a list that contain the input,
          // and hide the ones not containing the input while showing the ones that do
          $(list).find("a:not(:Contains(" + filter + "))").parent().slideUp();
          $(list).find("a:Contains(" + filter + ")").parent().slideDown();
        } else {
          $(list).find("li").slideDown();
        }
        return false;
      })
    .keyup( function () {
        // fire the above change event after every letter
        $(this).change();
    });
  }


  //ondomready
  $(function () {
    listFilter($("#header"), $("#list"));
  });
}(jQuery));






	

	cendari.addInit(function() {
		cendari.addTab("Project");
		cendari.addWidgetToActiveTab("form", "noteform", "border");
	}); 
	// $(document).ready(function(){
	// 	$('#id_name').keypress(function(event){
	// 		$('#id_slug').val($('#id_name').val().replace(/[^a-zA-Z0-9-_]/g, '_'));
	// 	});
	// 	$('#id_slug').keypress(function(event){
	// 		$('#id_slug').val($('#id_slug').val()..replace(/[^a-zA-Z0-9-_]/g, '_'));
	// 	});
	// })
	
	Ext.onReady(function(){
		$('#saveNoteID-btnEl').on('click',function(e){
			e.preventDefault();
			$('#noteform').submit();
		})
	})
	
	$( document ).ready(function() {    
		
		if($('#id_slug').length){
			$('#id_name').keyup(function() {
	        	var dInput = $(this).val();
				$('#id_slug').val(dInput.replace(/[^a-zA-Z0-9-_]/g, '_'));
	
	
				if (event.which !== 0) {
	     		   console.log("Charcter was typed. It was: " + String.fromCharCode(e.which));
	    		}
	
			});
	
			$('#id_slug').keyup(function() {
	        	var dInput = $(this).val();
				$('#id_slug').val(dInput.replace(/[^a-zA-Z0-9-_]/g, '_'));
			});

		}

	});
</script>
{% endblock form_functions %}